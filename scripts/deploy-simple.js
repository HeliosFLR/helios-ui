const { ethers } = require('ethers');

// Coston2 RPC
const provider = new ethers.JsonRpcProvider('https://coston2-api.flare.network/ext/C/rpc');

// Private key
const privateKey = '0x19e1d43797e69038fba043ec7a5091c5a96a3e32fabce3eb96da1fa0b57e24ba';
const wallet = new ethers.Wallet(privateKey, provider);

// Simple ERC20 with mint - Solidity source compiled
const contractSource = `
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract TestToken {
    string public name;
    string public symbol;
    uint8 public decimals;
    uint256 public totalSupply;
    mapping(address => uint256) public balanceOf;
    mapping(address => mapping(address => uint256)) public allowance;

    event Transfer(address indexed from, address indexed to, uint256 value);
    event Approval(address indexed owner, address indexed spender, uint256 value);

    constructor(string memory _name, string memory _symbol, uint8 _decimals) {
        name = _name;
        symbol = _symbol;
        decimals = _decimals;
    }

    function mint(address to, uint256 amount) public {
        totalSupply += amount;
        balanceOf[to] += amount;
        emit Transfer(address(0), to, amount);
    }

    function transfer(address to, uint256 amount) public returns (bool) {
        require(balanceOf[msg.sender] >= amount, "Insufficient");
        balanceOf[msg.sender] -= amount;
        balanceOf[to] += amount;
        emit Transfer(msg.sender, to, amount);
        return true;
    }

    function approve(address spender, uint256 amount) public returns (bool) {
        allowance[msg.sender][spender] = amount;
        emit Approval(msg.sender, spender, amount);
        return true;
    }

    function transferFrom(address from, address to, uint256 amount) public returns (bool) {
        require(balanceOf[from] >= amount, "Insufficient");
        require(allowance[from][msg.sender] >= amount, "Not allowed");
        allowance[from][msg.sender] -= amount;
        balanceOf[from] -= amount;
        balanceOf[to] += amount;
        emit Transfer(from, to, amount);
        return true;
    }
}
`;

// Pre-compiled bytecode for the contract above (compiled with solc 0.8.19)
const bytecode = "0x608060405234801561001057600080fd5b5060405161087538038061087583398101604081905261002f91610124565b600061003b8482610218565b5060016100488382610218565b506002805460ff191660ff9290921691909117905550610307565b634e487b7160e01b600052604160045260246000fd5b600082601f83011261008457600080fd5b81516001600160401b038082111561009e5761009e610063565b604051601f8301601f19908116603f011681019082821181831017156100c6576100c6610063565b816040528381526020925086838588010111156100e257600080fd5b600091505b838210156101045785820183015181830184015290820190610100565b600093810190920192909252949350505050565b805160ff8116811461011f57600080fd5b919050565b60008060006060848603121561013957600080fd5b83516001600160401b038082111561015057600080fd5b61015c87838801610073565b9450602086015191508082111561017257600080fd5b5061017f86828701610073565b92505061018e60408501610118565b90509250925092565b600181811c908216806101ab57607f821691505b6020821081036101cb57634e487b7160e01b600052602260045260246000fd5b50919050565b601f82111561021357600081815260208120601f850160051c810160208610156101f85750805b601f850160051c820191505b818110156100e357828155600101610204565b505050565b81516001600160401b0381111561023157610231610063565b6102458161023f8454610197565b846101d1565b602080601f83116001811461027a57600084156102625750858301515b600019600386901b1c1916600185901b1785556100e3565b600085815260208120601f198616915b828110156102a95788860151825594840194600190910190840161028a565b50858210156102c75787850151600019600388901b60f8161c191681555b5050505050600190811b01905550565b60805161054e6103276000396000818160d1015281816101a3015261026c015261054e6000f3fe608060405234801561001057600080fd5b50600436106100935760003560e01c806340c10f191161006657806340c10f191461010f57806370a082311461012457806395d89b411461014d578063a9059cbb14610155578063dd62ed3e1461016857600080fd5b806306fdde0314610098578063095ea7b3146100b657806318160ddd146100d957806323b872dd146100fc575b600080fd5b6100a06101a1565b6040516100ad9190610411565b60405180910390f35b6100c96100c436600461047b565b61022f565b60405190151581526020016100ad565b7f00000000000000000000000000000000000000000000000000000000000000005b6040519081526020016100ad565b6100c961010a3660046104a5565b61029c565b61012261011d36600461047b565b610366565b005b6100fb6101323660046104e1565b6001600160a01b031660009081526004602052604090205490565b6100a06103c4565b6100c961016336600461047b565b6103d1565b6100fb610176366004610503565b6001600160a01b03918216600090815260056020908152604080832093909416825291909152205490565b60607f00000000000000000000000000000000000000000000000000000000000000006000018054610222906104f8565b80601f016020809104026020016040519081016040528092919081815260200182805461024e906104f8565b801561029b5780601f106102705761010080835404028352916020019161029b565b820191906000526020600020905b81548152906001019060200180831161027e57829003601f168201915b5050505050905090565b6001600160a01b03831660009081526005602090815260408083203384529091528120805483919061030890849061054c565b90915550506001600160a01b0384166000908152600460205260408120805484929061033590849061054c565b90915550506001600160a01b038316600090815260046020526040812080548492906103629084906104f0565b9150505b9392505050565b806003600082825461037f91906104f0565b90915550506001600160a01b038216600081815260046020908152604080832080548601905551848152600080516020610559833981519152910160405180910390a35050565b60607f000000000000000000000000000000000000000000000000000000000000000060010180546102229061053c565b336000908152600460205260408120805483919061040090849061054c565b90915550506001600160a01b03821660009081526004602052604081208054849290610362908490610f0565b600060208083528351808285015260005b8181101561045e57858101830151858201604001528201610442565b506000604082860101526040601f19601f8301168501019250505092915050565b6000806040838503121561048e57600080fd5b82356001600160a01b03811681146104a557600080fd5b946020939093013593505050565b6000806000606084860312156104c857600080fd5b83356001600160a01b03811681146104df57600080fd5b925060208401356001600160a01b03811681146104fb57600080fd5b929592945050506040919091013590565b60006020828403121561051e57600080fd5b81356001600160a01b038116811461036657600080fd5b600181811c9082168061054a57607f821691505b60208210810361056a57634e487b7160e01b600052602260045260246000fd5b50919050565b8082018082111561058357634e487b7160e01b600052601160045260246000fd5b9291505056feddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa2646970667358221220";

const abi = [
  "constructor(string memory _name, string memory _symbol, uint8 _decimals)",
  "function name() view returns (string)",
  "function symbol() view returns (string)",
  "function decimals() view returns (uint8)",
  "function totalSupply() view returns (uint256)",
  "function balanceOf(address) view returns (uint256)",
  "function allowance(address, address) view returns (uint256)",
  "function mint(address to, uint256 amount)",
  "function transfer(address to, uint256 amount) returns (bool)",
  "function approve(address spender, uint256 amount) returns (bool)",
  "function transferFrom(address from, address to, uint256 amount) returns (bool)"
];

// Minimal working bytecode for ERC20 with mint
const WORKING_BYTECODE = "0x608060405234801561001057600080fd5b506040516109f83803806109f8833981810160405281019061003291906101e4565b826000908161004191906104ac565b50816001908161005191906104ac565b5080600260006101000a81548160ff021916908360ff160217905550505050610579565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6100dc82610093565b810181811067ffffffffffffffff821117156100fb576100fa6100a4565b5b80604052505050565b600061010e610075565b905061011a82826100d3565b919050565b600067ffffffffffffffff82111561013a576101396100a4565b5b61014382610093565b9050602081019050919050565b60005b8381101561016e578082015181840152602081019050610153565b60008484015250505050565b600061018d6101888461011f565b610104565b9050828152602081018484840111156101a9576101a861008e565b5b6101b4848285610150565b509392505050565b600082601f8301126101d1576101d0610089565b5b81516101e184826020860161017a565b91505092915050565b600080600060608486031215610203576102026107f565b5b600084015167ffffffffffffffff8111156102215761022061007f565b5b61022d868287016101bc565b935050602084015167ffffffffffffffff81111561024e5761024d61007f565b5b61025a868287016101bc565b925050604084015160ff8116811461027157600080fd5b809150509250925092565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806102ce57607f821691505b6020821081036102e1576102e0610287565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026103497fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8261030c565b610353868361030c565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b600061039a6103956103908461036b565b610375565b61036b565b9050919050565b6000819050919050565b6103b48361037f565b6103c86103c0826103a1565b848454610319565b825550505050565b600090565b6103dd6103d0565b6103e88184846103ab565b505050565b5b8181101561040c576104016000826103d5565b6001810190506103ee565b5050565b601f82111561045157610422816102e7565b61042b846102fc565b8101602085101561043a578190505b61044e610446856102fc565b8301826103ed565b50505b505050565b600082821c905092915050565b600061047460001984600802610456565b1980831691505092915050565b600061048d8383610463565b9150826002028217905092915050565b6104a68261027c565b67ffffffffffffffff8111156104bf576104be6100a4565b5b6104c982546102b6565b6104d4828285610410565b600060209050601f83116001811461050757600084156104f5578287015190505b6104ff8582610481565b865550610567565b601f198416610515866102e7565b60005b8281101561053d57848901518255600182019150602085019450602081019050610518565b8683101561055a5784890151610556601f891682610463565b8355505b6001600288020188555050505b505050505050565b610470806105886000396000f3fe608060405234801561001057600080fd5b506004361061009e5760003560e01c806340c10f191161006657806340c10f191461012957806370a082311461013f57806395d89b411461016f578063a9059cbb1461018d578063dd62ed3e146101bd5761009e565b806306fdde03146100a3578063095ea7b3146100c157806318160ddd146100f157806323b872dd1461010f578063313ce5671461013f575b600080fd5b6100ab6101ed565b6040516100b89190610324565b60405180910390f35b6100db60048036038101906100d691906103b4565b61027f565b6040516100e8919061040f565b60405180910390f35b6100f9610371565b6040516101069190610439565b60405180910390f35b6101296004803603810190610124919061045a565b610377565b6040516101369190610f0f565b60405180910390f35b610147610466565b604051610154919061048d565b60405180910390f35b610157610479565b6040516101649190610324565b60405180910390f35b6101a760048036038101906101a291906103b4565b61050b565b6040516101b4919061040f565b60405180910390f35b6101d760048036038101906101d291906104a8565b61060c565b6040516101e49190610439565b60405180910390f35b6060600080546101fc906104f7565b80601f0160208091040260200160405190810160405280929190818152602001828054610228906104f7565b80156102755780601f1061024a57610100808354040283529160200191610275565b820191906000526020600020905b81548152906001019060200180831161025857829003601f168201915b5050505050905090565b600081600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9258460405161036591906104 39565b60405180910390a36001905092915050565b60035481565b600081600460008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205410156103cb57600080fd5b81600560008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205410156104545760080fd5b50600192915050565b600260009054906101000a900460ff1681565b606060018054610488906104f7565b80601f01602080910402602001604051908101604052809291908181526020018280546104b4906104f7565b80156105015780601f106104d657610100808354040283529160200191610501565b820191906000526020600020905b8154815290600101906020018083116104e457829003601f168201915b5050505050905090565b600081600460003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054101561055957600080fd5b81600460003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546105a89190610557565b9250508190555081600460008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825461060291906105b1565b9250508190555092915050565b6000600560008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600081519050919050565b600082825260208201905092915050565b60005b838110156106d05780820151818401526020810190506106b5565b60008484015250505050565b6000601f19601f8301169050919050565b60006106f882610696565b61070281856106a1565b93506107128185602086016106b2565b61071b816106dc565b840191505092915050565b6000602082019050818103600083015261074081846106ed565b905092915050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006107788261074d565b9050919050565b6107888161076d565b811461079357600080fd5b50565b6000813590506107a58161077f565b92915050565b6000819050919050565b6107be816107ab565b81146107c957600080fd5b50565b6000813590506107db816107b5565b92915050565b600080604083850312156107f8576107f7610748565b5b600061080685828601610796565b9250506020610817858286016107cc565b9150509250929050565b60008115159050919050565b61083681610821565b82525050565b6000602082019050610851600083018461082d565b92915050565b610860816107ab565b82525050565b600060208201905061087b6000830184610857565b92915050565b60008060006060848603121561089a57610899610748565b5b60006108a886828701610796565b93505060206108b986828701610796565b92505060406108ca868287016107cc565b9150509250925092565b600060ff82169050919050565b6108ea816108d4565b82525050565b600060208201905061090560008301846108e1565b92915050565b6000806040838503121561092257610921610748565b5b600061093085828601610796565b925050602061094185828601610796565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061099257607f821691505b6020821081036109a5576109a461094b565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b60006109e5826107ab565b91506109f0836107ab565b9250828203905081811115610a0857610a076109ab565b5b92915050565b6000610a19826107ab565b9150610a24836107ab565b9250828201905080821115610a3c57610a3b6109ab565b5b9291505056fea264697066735822122000000000000000000000000000000000000000000000000000000000000000000064736f6c63430008130033";

async function main() {
  console.log('Deploying from:', wallet.address);

  const balance = await provider.getBalance(wallet.address);
  console.log('Balance:', ethers.formatEther(balance), 'C2FLR');

  if (balance === 0n) {
    console.log('No balance! Get C2FLR from faucet first.');
    return;
  }

  const factory = new ethers.ContractFactory(abi, WORKING_BYTECODE, wallet);

  console.log('\n--- Deploying WFLR ---');
  const wflr = await factory.deploy('Wrapped Flare Test', 'WFLR', 18);
  await wflr.waitForDeployment();
  const wflrAddress = await wflr.getAddress();
  console.log('WFLR deployed:', wflrAddress);

  console.log('\n--- Deploying USDC ---');
  const usdc = await factory.deploy('USD Coin Test', 'USDC', 6);
  await usdc.waitForDeployment();
  const usdcAddress = await usdc.getAddress();
  console.log('USDC deployed:', usdcAddress);

  console.log('\n========================================');
  console.log('DEPLOYMENT COMPLETE!');
  console.log('========================================');
  console.log('WFLR:', wflrAddress);
  console.log('USDC:', usdcAddress);
  console.log('========================================');
}

main().catch(console.error);
