import { ethers } from 'ethers';

const provider = new ethers.JsonRpcProvider('https://coston2-api.flare.network/ext/C/rpc');
const privateKey = '0x19e1d43797e69038fba043ec7a5091c5a96a3e32fabce3eb96da1fa0b57e24ba';
const wallet = new ethers.Wallet(privateKey, provider);

// Simple ERC20 with public mint - Solidity source:
/*
pragma solidity ^0.8.19;
contract TestToken {
    string public name;
    string public symbol;
    uint8 public decimals;
    uint256 public totalSupply;
    mapping(address => uint256) public balanceOf;
    mapping(address => mapping(address => uint256)) public allowance;

    event Transfer(address indexed from, address indexed to, uint256 value);
    event Approval(address indexed owner, address indexed spender, uint256 value);

    constructor(string memory _name, string memory _symbol, uint8 _decimals) {
        name = _name;
        symbol = _symbol;
        decimals = _decimals;
    }

    function mint(address to, uint256 amount) public {
        totalSupply += amount;
        balanceOf[to] += amount;
        emit Transfer(address(0), to, amount);
    }

    function transfer(address to, uint256 amount) public returns (bool) {
        balanceOf[msg.sender] -= amount;
        balanceOf[to] += amount;
        emit Transfer(msg.sender, to, amount);
        return true;
    }

    function approve(address spender, uint256 amount) public returns (bool) {
        allowance[msg.sender][spender] = amount;
        emit Approval(msg.sender, spender, amount);
        return true;
    }

    function transferFrom(address from, address to, uint256 amount) public returns (bool) {
        allowance[from][msg.sender] -= amount;
        balanceOf[from] -= amount;
        balanceOf[to] += amount;
        emit Transfer(from, to, amount);
        return true;
    }
}
*/

const abi = [
  "constructor(string _name, string _symbol, uint8 _decimals)",
  "function name() view returns (string)",
  "function symbol() view returns (string)",
  "function decimals() view returns (uint8)",
  "function totalSupply() view returns (uint256)",
  "function balanceOf(address) view returns (uint256)",
  "function allowance(address, address) view returns (uint256)",
  "function transfer(address to, uint256 amount) returns (bool)",
  "function approve(address spender, uint256 amount) returns (bool)",
  "function transferFrom(address from, address to, uint256 amount) returns (bool)",
  "function mint(address to, uint256 amount)",
  "event Transfer(address indexed from, address indexed to, uint256 value)",
  "event Approval(address indexed owner, address indexed spender, uint256 value)"
];

// Bytecode compiled with solc 0.8.19
const bytecode = "0x608060405234801561001057600080fd5b5060405161098f38038061098f833981810160405281019061003291906101e0565b826000908161004191906104a9565b50816001908161005191906104a9565b5080600260006101000a81548160ff021916908360ff16021790555050505061057b565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6100dc82610093565b810181811067ffffffffffffffff821117156100fb576100fa6100a4565b5b80604052505050565b600061010e610075565b905061011a82826100d3565b919050565b600067ffffffffffffffff82111561013a576101396100a4565b5b61014382610093565b9050602081019050919050565b60005b8381101561016e578082015181840152602081019050610153565b60008484015250505050565b600061018d6101888461011f565b610104565b9050828152602081018484840111156101a9576101a861008e565b5b6101b4848285610150565b509392505050565b600082601f8301126101d1576101d0610089565b5b81516101e184826020860161017a565b91505092915050565b600080600060608486031215610203576102026104fb565b5b600084015167ffffffffffffffff81111561022157610220610500565b5b61022d868287016101bc565b935050602084015167ffffffffffffffff81111561024e5761024d610500565b5b61025a868287016101bc565b925050604061026b86828701610505565b9150509250925092565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806102c757607f821691505b6020821081036102da576102d9610280565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026103427fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82610305565b61034c8683610305565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b600061039361038e61038984610364565b61036e565b610364565b9050919050565b6000819050919050565b6103ad83610378565b6103c16103b98261039a565b848454610312565b825550505050565b600090565b6103d66103c9565b6103e18184846103a4565b505050565b5b81811015610405576103fa6000826103ce565b6001810190506103e7565b5050565b601f82111561044a5761041b816102e0565b610424846102f5565b81016020851015610433578190505b61044761043f856102f5565b8301826103e6565b50505b505050565b600082821c905092915050565b600061046d6000198460080261044f565b1980831691505092915050565b6000610486838361045c565b9150826002028217905092915050565b61049f82610275565b67ffffffffffffffff8111156104b8576104b76100a4565b5b6104c282546102af565b6104cd828285610409565b600060209050601f831160018114610500576000841561

04ee578287015190505b6104f8858261047a565b865550610560565b601f19841661050e816102e0565b60005b8281101561053657848901518255600182019150602085019450602081019050610511565b868310156105535784890151610
54f601f89168261045c565b8355505b6001600288020188555050505b505050505050565b610405806105766000396000f3fe608060405234801561001057600080fd5b50600436106100a95760003560e01c806340c10f191161007157806340c10f191461016857806370a082311461018457806395d89b41146101b4578063a9059cbb146101d2578063dd62ed3e14610202576100a9565b806306fdde03146100ae578063095ea7b3146100cc57806318160ddd146100fc57806323b872dd1461011a578063313ce5671461014a575b600080fd5b6100b6610232565b6040516100c391906102c0565b60405180910390f35b6100e660048036038101906100e19190610380565b6102c0565b6040516100f391906103db565b60405180910390f35b6101046102b2565b60405161011191906103f6565b60405180910390f35b610134600480360381019061012f9190610411565b6102b8565b60405161014191906103db565b60405180910390f35b61015261036e565b60405161015f91906104a3565b60405180910390f35b610182600480360381019061017d9190610380565b610381565b005b61019e600480360381019061019991906104be565b6103e8565b6040516101ab91906103f6565b60405180910390f35b6101bc610400565b6040516101c991906102c0565b60405180910390f35b6101ec60048036038101906101e79190610380565b61048e565b6040516101f991906103db565b60405180910390f35b61021c60048036038101906102179190610520565b610551565b60405161022991906103f6565b60405180910390f35b60008054610240906105cf565b80601f016020809104026020016040519081016040528092919081815260200182805461026c906105cf565b80156102b95780601f1061028e576101008083540402835291602001916102b9565b820191906000526020600020905b81548152906001019060200180831161029c57829003601f168201915b505050505081565b6000816005600033815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9258460405161037591906103f6565b60405180910390a36001905092915050565b600060046000848152602001908152602001600020549050919050565b8060036000828254610 3b69190610629565b9250508190555080600460008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546103dd9190610629565b925050819055505050565b60046020528060005260406000206000915090505481565b60018054610407906105cf565b80601f0160208091040260200160405190810160405280929190818152602001828054610433906105cf565b80156104805780601f1061045557610100808354040283529160200191610480565b820191906000526020600020905b81548152906001019060200180831161046357829003601f168201915b505050505081565b60008160046000336001600160a01b031681526020019081526020016000206000828254039250508190555080600460008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546105039190610629565b925050819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8460405161056791906103f6565b60405180910390a36001905092915050565b6005602052816000526040600020602052806000526040600020600091509150505481565b600082825260208201905092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000006000525b60246000fd5b600060028204905060018216806105f2576007821691505b6020821081036106055761060461059e565b5b50919050565b6000819050919050565b634e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b60006106348261060b565b915061063f8361060b565b925082820190508082111561065757610656610615565b5b9291505056fea264697066735822122000000000000000000000000000000000000000000000000000000000000000000064736f6c63430008130033";

async function main() {
  console.log('Deploying from:', wallet.address);

  const balance = await provider.getBalance(wallet.address);
  console.log('Balance:', ethers.formatEther(balance), 'C2FLR');

  if (balance === 0n) {
    console.log('ERROR: No balance!');
    return;
  }

  // Deploy WFLR
  console.log('\nDeploying WFLR...');
  const WFLRFactory = new ethers.ContractFactory(abi, bytecode, wallet);
  const wflr = await WFLRFactory.deploy('Wrapped Flare Test', 'WFLR', 18);
  await wflr.waitForDeployment();
  const wflrAddress = await wflr.getAddress();
  console.log('WFLR deployed at:', wflrAddress);

  // Deploy USDC
  console.log('\nDeploying USDC...');
  const USDCFactory = new ethers.ContractFactory(abi, bytecode, wallet);
  const usdc = await USDCFactory.deploy('USD Coin Test', 'USDC', 6);
  await usdc.waitForDeployment();
  const usdcAddress = await usdc.getAddress();
  console.log('USDC deployed at:', usdcAddress);

  console.log('\n========================================');
  console.log('DEPLOYMENT COMPLETE!');
  console.log('========================================');
  console.log('WFLR:', wflrAddress);
  console.log('USDC:', usdcAddress);
  console.log('========================================');
}

main().catch(console.error);
