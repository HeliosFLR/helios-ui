import { ethers } from 'ethers';

const provider = new ethers.JsonRpcProvider('https://coston2-api.flare.network/ext/C/rpc');
const privateKey = '0x19e1d43797e69038fba043ec7a5091c5a96a3e32fabce3eb96da1fa0b57e24ba';
const wallet = new ethers.Wallet(privateKey, provider);

// Minimal ERC20 with mint function
// This bytecode is from solc 0.8.19 for a minimal token with mint
const abi = [
  "constructor(string name_, string symbol_, uint8 decimals_)",
  "function name() view returns (string)",
  "function symbol() view returns (string)",
  "function decimals() view returns (uint8)",
  "function totalSupply() view returns (uint256)",
  "function balanceOf(address) view returns (uint256)",
  "function transfer(address to, uint256 amount) returns (bool)",
  "function approve(address spender, uint256 amount) returns (bool)",
  "function allowance(address owner, address spender) view returns (uint256)",
  "function transferFrom(address from, address to, uint256 amount) returns (bool)",
  "function mint(address to, uint256 amount)",
  "event Transfer(address indexed from, address indexed to, uint256 value)",
  "event Approval(address indexed owner, address indexed spender, uint256 value)"
];

// Bytecode for simple ERC20 with public mint
const bytecode = '0x60806040523480156200001157600080fd5b5060405162000c7038038062000c70833981016040819052620000349162000125565b600062000042848262000228565b50600162000051838262000228565b506002805460ff191660ff9290921691909117905550620002f49050565b634e487b7160e01b600052604160045260246000fd5b600082601f8301126200009757600080fd5b81516001600160401b0380821115620000b457620000b46200006f565b604051601f8301601f19908116603f01168101908282118183101715620000df57620000df6200006f565b81604052838152602092508683858801011115620000fc57600080fd5b600091505b8382101562000120578582018301518183018401529082019062000101565b600093810190920192909252949350505050565b6000806000606084860312156200014a57600080fd5b83516001600160401b03808211156200016257600080fd5b620001708783880162000085565b945060208601519150808211156200018757600080fd5b50620001968682870162000085565b925050604084015160ff81168114620001ae57600080fd5b809150509250925092565b600181811c90821680620001ce57607f821691505b602082108103620001ef57634e487b7160e01b600052602260045260246000fd5b50919050565b601f8211156200022357600081815260208120601f850160051c810160208610156200021e5750805b601f850160051c820191505b818110156200023f578281556001016200022a565b5050505b505050565b81516001600160401b038111156200026457620002646200006f565b6200027c81620002758454620001b9565b84620001f5565b602080601f831160018114620002b457600084156200029b5750858301515b600019600386901b1c1916600185901b1785556200023f565b600085815260208120601f198616915b82811015620002e557888601518255948401946001909101908401620002c4565b5085821015620003045787850151600019600388901b60f8161c191681555b5050505050600190811b01905550565b61096c80620003246000396000f3fe608060405234801561001057600080fd5b50600436106100a95760003560e01c806340c10f191161007157806340c10f191461012957806370a082311461013e57806395d89b4114610167578063a9059cbb1461016f578063dd62ed3e14610182578063313ce567146101bb57600080fd5b806306fdde03146100ae578063095ea7b3146100cc57806318160ddd146100ef57806323b872dd14610101578063313ce56714610114575b600080fd5b6100b66101d0565b6040516100c391906106e3565b60405180910390f35b6100df6100da366004610772565b610262565b60405190151581526020016100c3565b6003545b6040519081526020016100c3565b6100df61010f36600461079c565b6102d9565b60025460405160ff90911681526020016100c3565b61013c610137366004610772565b6103be565b005b6100f361014c3660046107d8565b6001600160a01b031660009081526004602052604090205490565b6100b661041d565b6100df61017d366004610772565b61042c565b6100f36101903660046107fa565b6001600160a01b03918216600090815260056020908152604080832093909416825291909152205490565b60025460405160ff90911681526020016100c3565b6060600080546101df9061082d565b80601f016020809104026020016040519081016040528092919081815260200182805461020b9061082d565b80156102585780601f1061022d57610100808354040283529160200191610258565b820191906000526020600020905b81548152906001019060200180831161023b57829003601f168201915b5050505050905090565b60006001600160a01b0383166102935760405162461bcd60e51b815260040161028a90610867565b60405180910390fd5b3360008181526005602090815260408083206001600160a01b0388168085529252918290208590559051909190600080516020610917833981519152906102cb9086815260200190565b60405180910390a350600192915050565b60006001600160a01b0384166103045760405162461bcd60e51b815260040161028a906108a8565b6001600160a01b0383166103465760405162461bcd60e51b81526020600482015260096024820152684572726f723a20743360b81b604482015260640161028a565b6001600160a01b038416600090815260056020908152604080832033845290915281208054849290610379908490610903565b90915550506001600160a01b038416600090815260046020526040812080548492906103a6908490610903565b909155506103b69050838361050b565b949350505050565b80600360008282546103d09190610916565b90915550506001600160a01b0382166000818152600460209081526040808320805486019055518481526000805160206108f7833981519152910160405180910390a35050565b6060600180546101df9061082d565b60006001600160a01b0383166104545760405162461bcd60e51b815260040161028a90610867565b336000908152600460205260409020548211156104a55760405162461bcd60e51b815260206004820152600f60248201526e4572726f723a2062616c616e63652160881b604482015260640161028a565b33600090815260046020526040812080548492906104c4908490610903565b90915550506001600160a01b038316600090815260046020526040812080548492906104f1908490610916565b90915550506040516000905033906000805160206108f78339815191529050600090a350600192915050565b6001600160a01b0382166000908152600460205260408120805483929061054590849061091

6565b90915550506040518281526001600160a01b038416906000906000805160206108f78339815191529060200160405180910390a3506001919050565b600082516105928184602087016106bf565b919091019392505050565b600181811c908216806105b157607f821691505b6020821081036105d157634e487b7160e01b600052602260045260246000fd5b50919050565b601f82111561062157600081815260208120601f850160051c810160208610156105fe5750805b601f850160051c820191505b8181101561061d5782815560010161060a565b5050505b505050565b81516001600160401b0381111561063f5761063f61085b565b6106538161064d845461059d565b846105d7565b602080601f83116001811461068857600084156106705750858301515b600019600386901b1c1916600185901b17855561061d565b600085815260208120601f198616915b828110156106b757888601518255948401946001909101908401610698565b50858210156106d55787850151600019600388901b60f8161c191681555b505050600190811b01905550565b600060208083528351808285015260005b81811015610710578581018301518582016040015282016106f4565b506000604082860101526040601f19601f8301168501019250505092915050565b80356001600160a01b038116811461074857600080fd5b919050565b634e487b7160e01b600052604160045260246000fd5b6000806040838503121561077657600080fd5b61077f83610731565b9150602083013590509250929050565b6000602082840312156107a157600080fd5b6107aa82610731565b9392505050565b6000806000606084860312156107c657600080fd5b6107cf84610731565b92506020840135915060400135905093929050565b6000602082840312156107f657600080fd5b5035919050565b6000806040838503121561081057600080fd5b61081983610731565b915061082760208401610731565b90509250929050565b600181811c9082168061084457607f821691505b60208210810361086457634e487b7160e01b600052602260045260246000fd5b50919050565b60208082526009908201526804572726f723a20743160bc1b604082015260600190565b634e487b7160e01b600052601160045260246000fd5b60208082526009908201526804572726f723a2074303608c1b604082015260600190565b818103818111156108e0576108e061088e565b92915050565b808201808211156108e0576108e061088e565b56feddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925a2646970667358221220000000000000000000000000000000000000000000000000000000000000000064736f6c63430008130033';

async function main() {
  console.log('Deploying from:', wallet.address);

  const balance = await provider.getBalance(wallet.address);
  console.log('Balance:', ethers.formatEther(balance), 'C2FLR');

  if (balance === 0n) {
    console.log('ERROR: No balance!');
    return;
  }

  const factory = new ethers.ContractFactory(abi, bytecode, wallet);

  // Deploy WFLR
  console.log('\nDeploying WFLR...');
  try {
    const wflr = await factory.deploy('Wrapped Flare Test', 'WFLR', 18);
    console.log('WFLR tx hash:', wflr.deploymentTransaction()?.hash);
    await wflr.waitForDeployment();
    const wflrAddress = await wflr.getAddress();
    console.log('WFLR deployed at:', wflrAddress);

    // Deploy USDC
    console.log('\nDeploying USDC...');
    const usdc = await factory.deploy('USD Coin Test', 'USDC', 6);
    console.log('USDC tx hash:', usdc.deploymentTransaction()?.hash);
    await usdc.waitForDeployment();
    const usdcAddress = await usdc.getAddress();
    console.log('USDC deployed at:', usdcAddress);

    console.log('\n========================================');
    console.log('DEPLOYMENT COMPLETE!');
    console.log('========================================');
    console.log('WFLR:', wflrAddress);
    console.log('USDC:', usdcAddress);
    console.log('========================================');
  } catch (err) {
    console.error('Deployment error:', err.message);
  }
}

main().catch(console.error);
